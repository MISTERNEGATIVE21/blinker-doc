# 数据接口beta  
**改功能仅限专业版使用**  

## 获取token  
每次获取数据前，您都需要获取一次token  

0. 通过 **开发者管理台>密钥管理** 创建一组密钥  

1. 根据需要获取的数据，构造url（url参数说明见 **获取数据**），如：  
```js
url = "https://storage.diandeng.tech?e=1596510236&device=test&keyword=data1&quickDate=1h&queryType=avg"
```

2. 使用hmac_sha1算法进行签名，并做Base64安全编码，最后生成token  
```js
  sign = hmac_sha1(url, 'Your SecretKey')
  encodeSign = urlsafe_base64_encode(sign)
  token = "Your AccessKey" + ":" + encodeSign
```


## 获取数据  
时序数据获取提供了两种查询方式：  
1. 通过快速查询码，查询最近的时间段对应的数据  
2. 指定具体的时间段，查询该时间段对应的数据  

## 快速查询  
**接口url**  
```
https://storage.diandeng.tech/api/v1/ts
```

**方法**  
GET  

**参数**  
```json
{
    "e": "",    // 过期时间，unix时间戳(秒）
    "device": "",   // 设备名
    "keyword": "key1",  // 存储key
    "quickDate": "1h/1d/1w/1n/1y",  // 1小时、1天、1周、1月、1年
    "queryType": "avg/max/min", // 查询类型：平均、最大、最小
    "token": "" // 计算出的token
}
```

**响应**  
```json
{
    "data": [{"date": "", "keyword":  ""}, ...]
} 
```


## 按时间查询  
**接口url**  
```
https://storage.diandeng.tech/api/v1/ts
```

**方法**  
GET

**参数**  
```json
{
    "e": "",    // 过期时间，unix时间戳(秒）
    "device": "",   // 设备名
    "keyword": "key1",  // 存储key
    "queryDate": "['startDate', 'endDate']",  // 日期格式："YYYY-mm-dd HH:MM", 如"2020-08-05 10:20"
    "queryType": "avg/max/min",  // 查询类型：平均、最大、最小
    "token": "" // 计算出的token
}
```

**响应**  
```json
{
    "data": [{"date": "", "keyword":  ""}, ...]
} 
```
